<body>
    <div class="container">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>MintMade</title>

            <!--Elegant serif + body fonts -->
            <link rel="preconnect" href="https://fonts.googleapis.com">
            <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
            <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Lora:wght@300;400;500;600&display=swap" rel="stylesheet">

            <link rel="stylesheet" href="style.css">
        </head>

        <h1>'Fit your Fit'</h1>
        
        <div class="services-grid">
            <div class="service-card">
                <h2>Who We Are</h2>
                <p>Mintmade Online offers a well-curated range of fashion items for men and women.</p>
                <p>We aim to provide an enjoyable shopping experince fro all our customers.</p>
            </div>

            <div class="service-card">
                <h2>Suits, Shoes, Ties</h2>
                <p>Get your custom fit here, on us, no nonsense, no extra expense. Just good advice on how you want your suit to feel and fit.</p>
            </div>

            <div class="service-card">
                <h2>Begin your Fitting</h2>
                <p>Start your fitting journey here, by selecting a few simple fabrics and styles we can begin to customize your perfect suit.</p>
            </div>
        </div>
    </div>

    <!--Chat Widget-->
    <div class="chat-widget">
        <button class="chat-button" id="chatButton">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
            </svg>
        </button>

        <div class="chat-popup" id="chatPopup">
            <div class="chat-header">
                <h3>Ask Us Anything</h3>
                <button class="close-chat" id="closeChat">&times;</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="message bot">
                    Hello! How can I help you today? Feel free to ask any questions about our services.
                </div>
            </div>
            <div class="chat-input-container">
                <input 
                    type="text" 
                    class="chat-input" 
                    id="chatInput" 
                    placeholder="Type your message..."
                    autocomplete="off"
                >
                <button class="send-button" id="sendButton">Send</button>
            </div>
        </div>
    </div>

    <script>
        //Elements
        const chatButton = document.getElementById('chatButton');
        const chatPopup = document.getElementById('chatPopup');
        const closeChat = document.getElementById('closeChat');
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');
        const chatMessages = document.getElementById('chatMessages');

        //Open chat
        chatButton.addEventListener('click', () => {
            chatPopup.classList.add('active');
            chatInput.focus();
        });

        //Close chat
        closeChat.addEventListener('click', () => {
            chatPopup.classList.remove('active');
        });

        //Send message on button click
        sendButton.addEventListener('click', sendMessage);

        //Send message on Enter key
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.textContent = text;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;

            //Show user message
            addMessage(message, 'user');
            chatInput.value = '';
            sendButton.disabled = true;

            try {
                //This is where your model routing will eventually go
                const reply = await getAssistantReply(message);
                addMessage(reply, 'bot');
            } catch (error) {
                console.error(error);
                addMessage('Sorry, I encountered an error. Please try again.', 'bot');
            } finally {
                sendButton.disabled = false;
                chatInput.focus();
            }
        }

       //Real assistant reply calls local Node backend
        async function getAssistantReply(userMessage) {
            const response = await fetch('http://localhost:3000/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: userMessage,
                    model: currentModel
                })
            });

    if (!response.ok) {
        throw new Error('Backend error: ' + response.statusText);
    }

    const data = await response.json();
    return data.reply;
}

        const routeButtons = document.querySelectorAll('.route-button');
        //Default to Llama 3 so the chat bubble uses it right away
        let currentModel = 'llama3';

        routeButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                currentModel = btn.dataset.model;
                alert('Routing future chat requests to: ' + currentModel.toUpperCase());
            });
        });
    </script>
</body>